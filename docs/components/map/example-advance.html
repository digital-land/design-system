<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="robots" content="noindex, nofollow">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>
    <link href="https://digital-land.github.io/stylesheets/dl-frontend.css" rel="stylesheet" media="all" />
    <link href="https://digital-land.github.io/stylesheets/styleguide.css" rel="stylesheet" media="all" />
    <link href="https://digital-land.github.io/stylesheets/vendor/govuk-accessible-autocomplete.min.css" rel="stylesheet" media="all" /><!-- should make this optional, no need to load if not showing a map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
    integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
    crossorigin="" />

    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
        integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
        crossorigin=""></script>

    <script src="https://digital-land.github.io/javascripts/dl-maps.js"></script>
</head>

<body class="govuk-template__body app-example-page">
    <script>
        document.body.className = ((document.body.className) ? document.body.className +
            ' js-enabled' : 'js-enabled');
    </script>




<div class="dl-map__wrapper"><div 
        class="dl-map govuk-!-margin-bottom-0"
        id="aMap"
        data-module="boundary-map"
        style="height: 700px;"   
    >
        <noscript>To view this map, you need to enable JavaScript.</noscript>
    </div>
    <div class="dl-map__loader">
        <div class="dl-map__loader-msg">
            <div class="dl-map__spinning-loader"></div>
            <span class="govuk-!-font-size-24 govuk-!-margin-top-6">Loading brownfield land data</span>
        </div>
    </div>
    
    <div class="dl-map__side-panel js-hidden">
        
<div class="dl-map__side-panel__section">
<h3 class="govuk-heading-s govuk-!-margin-bottom-0">Displayed on map</h3>
</div>
<div class="dl-map__side-panel__section dl-map__side-panel__section--title js-hidden" data-module="dl-map-items">
  <p class="govuk-body govuk-!-margin-bottom-1"><span class="organisation-count"></span> organisation boundaries</p>
  <p class="govuk-body govuk-!-margin-bottom-1 js-hidden">Active: <span class="active-organisation dl-map__highlight--yellow"></span></p>
</div>
<div class="dl-map__side-panel__section dl-map__side-panel__section--blue">
  
<div class="govuk-form-group govuk-!-margin-bottom-0">
  <label class="govuk-label" for="dl-organisation-autocomplete">
    Search for an organisation
  </label>
  <span id="dl-organisation-autocomplete-error" class="govuk-error-message" role="alert">
    <span class="govuk-visually-hidden">Error:</span> Value entered not recognised, please try again
  </span>
  <select class="govuk-select" id="dl-organisation-autocomplete" name="dl-organisation-autocomplete">
    <option value=""></option>
    <option value="development-corporation:Q20648596">Old Oak and Park Royal Development Corporation</option>
    <option value="development-corporation:Q4916714">Birmingham Heartlands Development Corporation</option>
    <option value="development-corporation:Q6670544">London Legacy Development Corporation</option>
    <option value="development-corporation:Q6670837">London Thames Gateway Development Corporation</option>
    <option value="development-corporation:Q72456968">South Tees Development Corporation</option>
    <option value="development-corporation:Q72463795">Ebbsfleet Development Corporation</option>
    <option value="development-corporation:Q7799380">Thurrock Thames Gateway Development Corporation</option>
    <option value="development-corporation:Q7860503">Tyne and Wear Development Corporation</option>
    <option value="development-corporation:Q7986087">West Northamptonshire Development Corporation</option>
    <option value="government-organisation:D303">Office for National Statistics</option>
    <option value="government-organisation:D38">Ordnance Survey</option>
    <option value="government-organisation:D4">Ministry of Housing, Communities and Local Government</option>
    <option value="government-organisation:D69">HM Land Registry</option>
    <option value="government-organisation:EA39">Planning Inspectorate</option>
    <option value="government-organisation:EA87">Valuation Office Agency</option>
    <option value="government-organisation:PB1164">Historic England</option>
    <option value="government-organisation:PB1204">Valuation Tribunal for England</option>
    <option value="government-organisation:PB1218">Regulator of Social Housing</option>
    <option value="government-organisation:PB1232">Homes England</option>
    <option value="government-organisation:PB160">Building Regulations Advisory Committee</option>
    <option value="government-organisation:PB207">Health and Safety Executive</option>
    <option value="government-organisation:PB372">Housing Ombudsman</option>
    <option value="government-organisation:PB373">Leasehold Advisory Service</option>
    <option value="government-organisation:PB375">Valuation Tribunal Service</option>
    <option value="government-organisation:PC163">Architects Registration Board</option>
    <option value="local-authority-eng:ADU">Adur District Council</option>
    <option value="local-authority-eng:ALL">Allerdale Borough Council</option>
    <option value="local-authority-eng:AMB">Amber Valley Borough Council</option>
    <option value="local-authority-eng:ARU">Arun District Council</option>
    <option value="local-authority-eng:ASF">Ashford Borough Council</option>
    <option value="local-authority-eng:ASH">Ashfield District Council</option>
    <option value="local-authority-eng:AYL">Aylesbury Vale District Council</option>
    <option value="local-authority-eng:BAB">Babergh District Council</option>
    <option value="local-authority-eng:BAE">Bassetlaw District Council</option>
    <option value="local-authority-eng:BAI">Basildon Borough Council</option>
    <option value="local-authority-eng:BAN">Basingstoke and Deane Borough Council</option>
    <option value="local-authority-eng:BAR">Barrow-in-Furness Borough Council</option>
    <option value="local-authority-eng:BAS">Bath and North East Somerset Council</option>
    <option value="local-authority-eng:BBD">Blackburn with Darwen Borough Council</option>
    <option value="local-authority-eng:BDF">Bedford Borough Council</option>
    <option value="local-authority-eng:BDG">London Borough of Barking and Dagenham</option>
    <option value="local-authority-eng:BEN">London Borough of Brent</option>
    <option value="local-authority-eng:BEX">London Borough of Bexley</option>
    <option value="local-authority-eng:BIR">Birmingham City Council</option>
    <option value="local-authority-eng:BKM">Buckinghamshire County Council</option>
    <option value="local-authority-eng:BLA">Blaby District Council</option>
    <option value="local-authority-eng:BMH">Bournemouth Borough Council</option>
    <option value="local-authority-eng:BNE">London Borough of Barnet</option>
    <option value="local-authority-eng:BNH">Brighton and Hove City Council</option>
    <option value="local-authority-eng:BNS">Barnsley Metropolitan Borough Council</option>
    <option value="local-authority-eng:BOL">Bolton Metropolitan Borough Council</option>
    <option value="local-authority-eng:BOS">Bolsover District Council</option>
    <option value="local-authority-eng:BOT">Boston Borough Council</option>
    <option value="local-authority-eng:BPC">Bournemouth, Christchurch and Poole Council</option>
    <option value="local-authority-eng:BPL">Blackpool Borough Council</option>
    <option value="local-authority-eng:BRA">Braintree District Council</option>
    <option value="local-authority-eng:BRC">Bracknell Forest Council</option>
    <option value="local-authority-eng:BRD">City of Bradford Metropolitan District Council</option>
    <option value="local-authority-eng:BRE">Breckland District Council</option>
    <option value="local-authority-eng:BRM">Bromsgrove District Council</option>
    <option value="local-authority-eng:BRO">Broadland District Council</option>
    <option value="local-authority-eng:BRT">Broxtowe Borough Council</option>
    <option value="local-authority-eng:BRW">Brentwood Borough Council</option>
    <option value="local-authority-eng:BRX">Broxbourne Borough Council</option>
    <option value="local-authority-eng:BRY">London Borough of Bromley</option>
    <option value="local-authority-eng:BST">Bristol City Council</option>
    <option value="local-authority-eng:BUC">Buckinghamshire Council</option>
    <option value="local-authority-eng:BUN">Burnley Borough Council</option>
    <option value="local-authority-eng:BUR">Bury Metropolitan Borough Council</option>
    <option value="local-authority-eng:CAB">Cambridge City Council</option>
    <option value="local-authority-eng:CAM">Cambridgeshire County Council</option>
    <option value="local-authority-eng:CAN">Cannock Chase District Council</option>
    <option value="local-authority-eng:CAR">Carlisle City Council</option>
    <option value="local-authority-eng:CAS">Castle Point Borough Council</option>
    <option value="local-authority-eng:CAT">Canterbury City Council</option>
    <option value="local-authority-eng:CBF">Central Bedfordshire Council</option>
    <option value="local-authority-eng:CHA">Charnwood Borough Council</option>
    <option value="local-authority-eng:CHC">Christchurch Borough Council</option>
    <option value="local-authority-eng:CHE">Cheshire East Council</option>
    <option value="local-authority-eng:CHI">Chichester District Council</option>
    <option value="local-authority-eng:CHL">Chelmsford City Council</option>
    <option value="local-authority-eng:CHN">Chiltern District Council</option>
    <option value="local-authority-eng:CHO">Chorley Borough Council</option>
    <option value="local-authority-eng:CHR">Cherwell District Council</option>
    <option value="local-authority-eng:CHS">Chesterfield Borough Council</option>
    <option value="local-authority-eng:CHT">Cheltenham Borough Council</option>
    <option value="local-authority-eng:CHW">Cheshire West and Chester Council</option>
    <option value="local-authority-eng:CLD">Calderdale Metropolitan Borough Council</option>
    <option value="local-authority-eng:CMA">Cumbria County Council</option>
    <option value="local-authority-eng:CMD">London Borough of Camden</option>
    <option value="local-authority-eng:COL">Colchester Borough Council</option>
    <option value="local-authority-eng:CON">Cornwall Council</option>
    <option value="local-authority-eng:COP">Copeland Borough Council</option>
    <option value="local-authority-eng:COR">Corby Borough Council</option>
    <option value="local-authority-eng:COT">Cotswold District Council</option>
    <option value="local-authority-eng:COV">Coventry City Council</option>
    <option value="local-authority-eng:CPCA">Cambridgeshire and Peterborough Combined Authority</option>
    <option value="local-authority-eng:CRA">Craven District Council</option>
    <option value="local-authority-eng:CRW">Crawley Borough Council</option>
    <option value="local-authority-eng:CRY">London Borough of Croydon</option>
    <option value="local-authority-eng:DAC">Dacorum Borough Council</option>
    <option value="local-authority-eng:DAL">Darlington Borough Council</option>
    <option value="local-authority-eng:DAR">Dartford Borough Council</option>
    <option value="local-authority-eng:DAV">Daventry District Council</option>
    <option value="local-authority-eng:DBY">Derbyshire County Council</option>
    <option value="local-authority-eng:DEB">Derbyshire Dales District Council</option>
    <option value="local-authority-eng:DER">Derby City Council</option>
    <option value="local-authority-eng:DEV">Devon County Council</option>
    <option value="local-authority-eng:DNC">Doncaster Metropolitan Borough Council</option>
    <option value="local-authority-eng:DOR">Dorset County Council</option>
    <option value="local-authority-eng:DOV">Dover District Council</option>
    <option value="local-authority-eng:DST">Dorset Council</option>
    <option value="local-authority-eng:DUD">Dudley Metropolitan Borough Council</option>
    <option value="local-authority-eng:DUR">Durham County Council</option>
    <option value="local-authority-eng:EAL">London Borough of Ealing</option>
    <option value="local-authority-eng:EAS">Eastbourne Borough Council</option>
    <option value="local-authority-eng:EAT">Eastleigh Borough Council</option>
    <option value="local-authority-eng:ECA">East Cambridgeshire District Council</option>
    <option value="local-authority-eng:EDE">East Devon District Council</option>
    <option value="local-authority-eng:EDN">Eden District Council</option>
    <option value="local-authority-eng:EDO">East Dorset District Council</option>
    <option value="local-authority-eng:EHA">East Hampshire District Council</option>
    <option value="local-authority-eng:EHE">East Hertfordshire District Council</option>
    <option value="local-authority-eng:ELI">East Lindsey District Council</option>
    <option value="local-authority-eng:ELM">Elmbridge Borough Council</option>
    <option value="local-authority-eng:ENF">London Borough of Enfield</option>
    <option value="local-authority-eng:ENO">East Northamptonshire Council</option>
    <option value="local-authority-eng:EPP">Epping Forest District Council</option>
    <option value="local-authority-eng:EPS">Epsom and Ewell Borough Council</option>
    <option value="local-authority-eng:ERE">Erewash Borough Council</option>
    <option value="local-authority-eng:ERY">East Riding of Yorkshire Council</option>
    <option value="local-authority-eng:ESK">East Suffolk Council</option>
    <option value="local-authority-eng:ESS">Essex County Council</option>
    <option value="local-authority-eng:EST">East Staffordshire Borough Council</option>
    <option value="local-authority-eng:ESX">East Sussex County Council</option>
    <option value="local-authority-eng:EXE">Exeter City Council</option>
    <option value="local-authority-eng:FAR">Fareham Borough Council</option>
    <option value="local-authority-eng:FEN">Fenland District Council</option>
    <option value="local-authority-eng:FOE">Forest of Dean District Council</option>
    <option value="local-authority-eng:FOR">Forest Heath District Council</option>
    <option value="local-authority-eng:FYL">Fylde Borough Council</option>
    <option value="local-authority-eng:GAT">Gateshead Metropolitan Borough Council</option>
    <option value="local-authority-eng:GED">Gedling Borough Council</option>
    <option value="local-authority-eng:GLA">Greater London Authority</option>
    <option value="local-authority-eng:GLO">Gloucester City Council</option>
    <option value="local-authority-eng:GLS">Gloucestershire County Council</option>
    <option value="local-authority-eng:GMCA">Greater Manchester Combined Authority</option>
    <option value="local-authority-eng:GOS">Gosport Borough Council</option>
    <option value="local-authority-eng:GRA">Gravesham Borough Council</option>
    <option value="local-authority-eng:GRE">Royal Borough of Greenwich</option>
    <option value="local-authority-eng:GRT">Guildford Borough Council</option>
    <option value="local-authority-eng:GRY">Great Yarmouth Borough Council</option>
    <option value="local-authority-eng:HAA">Havant Borough Council</option>
    <option value="local-authority-eng:HAE">Hambleton District Council</option>
    <option value="local-authority-eng:HAG">Harrogate Borough Council</option>
    <option value="local-authority-eng:HAL">Halton Borough Council</option>
    <option value="local-authority-eng:HAM">Hampshire County Council</option>
    <option value="local-authority-eng:HAO">Harborough District Council</option>
    <option value="local-authority-eng:HAR">Harlow District Council</option>
    <option value="local-authority-eng:HAS">Hastings Borough Council</option>
    <option value="local-authority-eng:HAT">Hart District Council</option>
    <option value="local-authority-eng:HAV">London Borough of Havering</option>
    <option value="local-authority-eng:HCK">London Borough of Hackney</option>
    <option value="local-authority-eng:HEF">Herefordshire Council</option>
    <option value="local-authority-eng:HER">Hertsmere Borough Council</option>
    <option value="local-authority-eng:HIG">High Peak Borough Council</option>
    <option value="local-authority-eng:HIL">London Borough of Hillingdon</option>
    <option value="local-authority-eng:HIN">Hinckley and Bosworth Borough Council</option>
    <option value="local-authority-eng:HMF">London Borough of Hammersmith & Fulham</option>
    <option value="local-authority-eng:HNS">London Borough of Hounslow</option>
    <option value="local-authority-eng:HOR">Horsham District Council</option>
    <option value="local-authority-eng:HPL">Hartlepool Borough Council</option>
    <option value="local-authority-eng:HRT">Hertfordshire County Council</option>
    <option value="local-authority-eng:HRW">London Borough of Harrow</option>
    <option value="local-authority-eng:HRY">London Borough of Haringey</option>
    <option value="local-authority-eng:HUN">Huntingdonshire District Council</option>
    <option value="local-authority-eng:HYN">Hyndburn Borough Council</option>
    <option value="local-authority-eng:IOS">Council of the Isles of Scilly</option>
    <option value="local-authority-eng:IOW">Isle of Wight Council</option>
    <option value="local-authority-eng:IPS">Ipswich Borough Council</option>
    <option value="local-authority-eng:ISL">London Borough of Islington</option>
    <option value="local-authority-eng:KEC">Royal Borough of Kensington and Chelsea</option>
    <option value="local-authority-eng:KEN">Kent County Council</option>
    <option value="local-authority-eng:KET">Kettering Borough Council</option>
    <option value="local-authority-eng:KHL">Hull City Council</option>
    <option value="local-authority-eng:KIN">Borough Council of King's Lynn and West Norfolk</option>
    <option value="local-authority-eng:KIR">Kirklees Council</option>
    <option value="local-authority-eng:KTT">Royal Borough of Kingston upon Thames</option>
    <option value="local-authority-eng:KWL">Knowsley Metropolitan Borough Council</option>
    <option value="local-authority-eng:LAC">Lancaster City Council</option>
    <option value="local-authority-eng:LAN">Lancashire County Council</option>
    <option value="local-authority-eng:LBH">London Borough of Lambeth</option>
    <option value="local-authority-eng:LCE">Leicester City Council</option>
    <option value="local-authority-eng:LCR">Liverpool City Region</option>
    <option value="local-authority-eng:LDS">Leeds City Council</option>
    <option value="local-authority-eng:LEC">Leicestershire County Council</option>
    <option value="local-authority-eng:LEE">Lewes District Council</option>
    <option value="local-authority-eng:LEW">London Borough of Lewisham</option>
    <option value="local-authority-eng:LIC">City of Lincoln Council</option>
    <option value="local-authority-eng:LIF">Lichfield District Council</option>
    <option value="local-authority-eng:LIN">Lincolnshire County Council</option>
    <option value="local-authority-eng:LIV">Liverpool City Council</option>
    <option value="local-authority-eng:LND">City of London Corporation</option>
    <option value="local-authority-eng:LUT">Luton Borough Council</option>
    <option value="local-authority-eng:MAI">Maidstone Borough Council</option>
    <option value="local-authority-eng:MAL">Maldon District Council</option>
    <option value="local-authority-eng:MAN">Manchester City Council</option>
    <option value="local-authority-eng:MAS">Mansfield District Council</option>
    <option value="local-authority-eng:MAV">Malvern Hills District Council</option>
    <option value="local-authority-eng:MDB">Middlesbrough Borough Council</option>
    <option value="local-authority-eng:MDE">Mid Devon District Council</option>
    <option value="local-authority-eng:MDW">Medway Council</option>
    <option value="local-authority-eng:MEL">Melton Borough Council</option>
    <option value="local-authority-eng:MEN">Mendip District Council</option>
    <option value="local-authority-eng:MIK">Milton Keynes Council</option>
    <option value="local-authority-eng:MOL">Mole Valley District Council</option>
    <option value="local-authority-eng:MRT">London Borough of Merton</option>
    <option value="local-authority-eng:MSS">Mid Sussex District Council</option>
    <option value="local-authority-eng:MSU">Mid Suffolk District Council</option>
    <option value="local-authority-eng:NBL">Northumberland County Council</option>
    <option value="local-authority-eng:NDE">North Devon District Council</option>
    <option value="local-authority-eng:NDO">North Dorset District Council</option>
    <option value="local-authority-eng:NEA">Newark and Sherwood District Council</option>
    <option value="local-authority-eng:NEC">Newcastle-under-Lyme Borough Council</option>
    <option value="local-authority-eng:NECA">North East Combined Authority</option>
    <option value="local-authority-eng:NED">North East Derbyshire District Council</option>
    <option value="local-authority-eng:NEL">North East Lincolnshire Council</option>
    <option value="local-authority-eng:NET">Newcastle City Council</option>
    <option value="local-authority-eng:NEW">New Forest District Council</option>
    <option value="local-authority-eng:NFK">Norfolk County Council</option>
    <option value="local-authority-eng:NGM">Nottingham City Council</option>
    <option value="local-authority-eng:NHE">North Hertfordshire District Council</option>
    <option value="local-authority-eng:NKE">North Kesteven District Council</option>
    <option value="local-authority-eng:NLN">North Lincolnshire Council</option>
    <option value="local-authority-eng:NNO">North Norfolk District Council</option>
    <option value="local-authority-eng:NOR">Northampton Borough Council</option>
    <option value="local-authority-eng:NOW">Norwich City Council</option>
    <option value="local-authority-eng:NSM">North Somerset  Council</option>
    <option value="local-authority-eng:NTCA">North of Tyne Combined Authority</option>
    <option value="local-authority-eng:NTH">Northamptonshire County Council</option>
    <option value="local-authority-eng:NTT">Nottinghamshire County Council</option>
    <option value="local-authority-eng:NTY">North Tyneside Council</option>
    <option value="local-authority-eng:NUN">Nuneaton and Bedworth Borough Council</option>
    <option value="local-authority-eng:NWA">North Warwickshire Borough Council</option>
    <option value="local-authority-eng:NWL">North West Leicestershire District Council</option>
    <option value="local-authority-eng:NWM">London Borough of Newham</option>
    <option value="local-authority-eng:NYK">North Yorkshire County Council</option>
    <option value="local-authority-eng:OAD">Oadby and Wigston Borough Council</option>
    <option value="local-authority-eng:OLD">Oldham Metropolitan Borough Council</option>
    <option value="local-authority-eng:OXF">Oxfordshire County Council</option>
    <option value="local-authority-eng:OXO">Oxford City Council</option>
    <option value="local-authority-eng:PEN">Pendle Borough Council</option>
    <option value="local-authority-eng:PLY">Plymouth City Council</option>
    <option value="local-authority-eng:POL">Borough of Poole</option>
    <option value="local-authority-eng:POR">Portsmouth City Council</option>
    <option value="local-authority-eng:PRE">Preston City Council</option>
    <option value="local-authority-eng:PTE">Peterborough City Council</option>
    <option value="local-authority-eng:PUR">Purbeck District Council</option>
    <option value="local-authority-eng:RCC">Redcar and Cleveland Borough Council</option>
    <option value="local-authority-eng:RCH">Rochdale Metropolitan Borough Council</option>
    <option value="local-authority-eng:RDB">London Borough of Redbridge</option>
    <option value="local-authority-eng:RDG">Reading Borough Council</option>
    <option value="local-authority-eng:RED">Redditch Borough Council</option>
    <option value="local-authority-eng:REI">Reigate and Banstead Borough Council</option>
    <option value="local-authority-eng:RIB">Ribble Valley Borough Council</option>
    <option value="local-authority-eng:RIC">London Borough of Richmond upon Thames</option>
    <option value="local-authority-eng:RIH">Richmondshire District Council</option>
    <option value="local-authority-eng:ROC">Rochford District Council</option>
    <option value="local-authority-eng:ROH">Rother District Council</option>
    <option value="local-authority-eng:ROS">Rossendale Borough Council</option>
    <option value="local-authority-eng:ROT">Rotherham Metropolitan Borough Council</option>
    <option value="local-authority-eng:RUG">Rugby Borough Council</option>
    <option value="local-authority-eng:RUH">Rushmoor Borough Council</option>
    <option value="local-authority-eng:RUN">Runnymede Borough Council</option>
    <option value="local-authority-eng:RUS">Rushcliffe Borough Council</option>
    <option value="local-authority-eng:RUT">Rutland County Council</option>
    <option value="local-authority-eng:RYE">Ryedale District Council</option>
    <option value="local-authority-eng:SAL">St Albans City and District Council</option>
    <option value="local-authority-eng:SAW">Sandwell Metropolitan Borough Council</option>
    <option value="local-authority-eng:SBU">South Bucks District Council</option>
    <option value="local-authority-eng:SCA">South Cambridgeshire District Council</option>
    <option value="local-authority-eng:SCE">Scarborough Borough Council</option>
    <option value="local-authority-eng:SCR">Sheffield City Region</option>
    <option value="local-authority-eng:SDE">South Derbyshire District Council</option>
    <option value="local-authority-eng:SED">St Edmundsbury Borough Council</option>
    <option value="local-authority-eng:SEG">Sedgemoor District Council</option>
    <option value="local-authority-eng:SEL">Selby District Council</option>
    <option value="local-authority-eng:SEV">Sevenoaks District Council</option>
    <option value="local-authority-eng:SFK">Suffolk County Council</option>
    <option value="local-authority-eng:SFT">Sefton Metropolitan Borough Council</option>
    <option value="local-authority-eng:SGC">South Gloucestershire Council</option>
    <option value="local-authority-eng:SHA">South Hams District Council</option>
    <option value="local-authority-eng:SHE">Folkestone and Hythe Council</option>
    <option value="local-authority-eng:SHF">Sheffield City Council</option>
    <option value="local-authority-eng:SHN">St Helens Council</option>
    <option value="local-authority-eng:SHO">South Holland District Council</option>
    <option value="local-authority-eng:SHR">Shropshire Council</option>
    <option value="local-authority-eng:SKE">South Kesteven District Council</option>
    <option value="local-authority-eng:SKP">Stockport Metropolitan Borough Council</option>
    <option value="local-authority-eng:SLA">South Lakeland District Council</option>
    <option value="local-authority-eng:SLF">Salford City Council</option>
    <option value="local-authority-eng:SLG">Slough Borough Council</option>
    <option value="local-authority-eng:SND">Sunderland City Council</option>
    <option value="local-authority-eng:SNO">South Norfolk District Council</option>
    <option value="local-authority-eng:SNR">South Northamptonshire Council</option>
    <option value="local-authority-eng:SOL">Solihull Metropolitan Borough Council</option>
    <option value="local-authority-eng:SOM">Somerset County Council</option>
    <option value="local-authority-eng:SOS">Southend-on-Sea Borough Council</option>
    <option value="local-authority-eng:SOX">South Oxfordshire District Council</option>
    <option value="local-authority-eng:SPE">Spelthorne Borough Council</option>
    <option value="local-authority-eng:SRI">South Ribble Borough Council</option>
    <option value="local-authority-eng:SRY">Surrey County Council</option>
    <option value="local-authority-eng:SSO">South Somerset District Council</option>
    <option value="local-authority-eng:SST">South Staffordshire Council</option>
    <option value="local-authority-eng:STA">Stafford Borough Council</option>
    <option value="local-authority-eng:STE">Stoke-on-Trent City Council</option>
    <option value="local-authority-eng:STF">Staffordshire Moorlands District Council</option>
    <option value="local-authority-eng:STH">Southampton City Council</option>
    <option value="local-authority-eng:STN">London Borough of Sutton</option>
    <option value="local-authority-eng:STO">Stroud District Council</option>
    <option value="local-authority-eng:STR">Stratford-on-Avon District Council</option>
    <option value="local-authority-eng:STS">Staffordshire County Council</option>
    <option value="local-authority-eng:STT">Stockton-on-Tees Borough Council</option>
    <option value="local-authority-eng:STV">Stevenage Borough Council</option>
    <option value="local-authority-eng:STY">South Tyneside Council</option>
    <option value="local-authority-eng:SUF">Suffolk Coastal District Council</option>
    <option value="local-authority-eng:SUR">Surrey Heath Borough Council</option>
    <option value="local-authority-eng:SWD">Swindon Borough Council</option>
    <option value="local-authority-eng:SWK">London Borough of Southwark</option>
    <option value="local-authority-eng:SWL">Swale Borough Council</option>
    <option value="local-authority-eng:SWT">Somerset West and Taunton Council</option>
    <option value="local-authority-eng:TAM">Tameside Metropolitan Borough Council</option>
    <option value="local-authority-eng:TAN">Tandridge District Council</option>
    <option value="local-authority-eng:TAU">Taunton Deane Borough Council</option>
    <option value="local-authority-eng:TAW">Tamworth Borough Council</option>
    <option value="local-authority-eng:TEI">Teignbridge District Council</option>
    <option value="local-authority-eng:TEN">Tendring District Council</option>
    <option value="local-authority-eng:TES">Test Valley Borough Council</option>
    <option value="local-authority-eng:TEW">Tewkesbury Borough Council</option>
    <option value="local-authority-eng:TFW">Telford & Wrekin Council</option>
    <option value="local-authority-eng:THA">Thanet District Council</option>
    <option value="local-authority-eng:THE">Three Rivers District Council</option>
    <option value="local-authority-eng:THR">Thurrock Council</option>
    <option value="local-authority-eng:TOB">Torbay Council</option>
    <option value="local-authority-eng:TON">Tonbridge and Malling Borough Council</option>
    <option value="local-authority-eng:TOR">Torridge District Council</option>
    <option value="local-authority-eng:TRF">Trafford Metropolitan Borough Council</option>
    <option value="local-authority-eng:TUN">Tunbridge Wells Borough Council</option>
    <option value="local-authority-eng:TVCA">Tees Valley Combined Authority</option>
    <option value="local-authority-eng:TWH">London Borough of Tower Hamlets</option>
    <option value="local-authority-eng:UTT">Uttlesford District Council</option>
    <option value="local-authority-eng:VAL">Vale of White Horse District Council</option>
    <option value="local-authority-eng:WAE">Waverley Borough Council</option>
    <option value="local-authority-eng:WAR">Warwickshire County Council</option>
    <option value="local-authority-eng:WAT">Watford Borough Council</option>
    <option value="local-authority-eng:WAV">Waveney District Council</option>
    <option value="local-authority-eng:WAW">Warwick District Council</option>
    <option value="local-authority-eng:WBK">West Berkshire Council</option>
    <option value="local-authority-eng:WDE">West Devon Borough Council</option>
    <option value="local-authority-eng:WDO">West Dorset District Council</option>
    <option value="local-authority-eng:WEA">Wealden District Council</option>
    <option value="local-authority-eng:WECA">West of England Combined Authority</option>
    <option value="local-authority-eng:WEL">Wellingborough Borough Council</option>
    <option value="local-authority-eng:WEW">Welwyn Hatfield Borough Council</option>
    <option value="local-authority-eng:WEY">Weymouth and Portland Borough Council</option>
    <option value="local-authority-eng:WFT">London Borough of Waltham Forest</option>
    <option value="local-authority-eng:WGN">Wigan Metropolitan Borough Council</option>
    <option value="local-authority-eng:WIL">Wiltshire Council</option>
    <option value="local-authority-eng:WIN">Winchester City Council</option>
    <option value="local-authority-eng:WKF">Wakefield Metropolitan District Council</option>
    <option value="local-authority-eng:WLA">West Lancashire Borough Council</option>
    <option value="local-authority-eng:WLI">West Lindsey District Council</option>
    <option value="local-authority-eng:WLL">Walsall Metropolitan Borough Council</option>
    <option value="local-authority-eng:WLV">City of Wolverhampton Council</option>
    <option value="local-authority-eng:WMCA">West Midlands Combined Authority</option>
    <option value="local-authority-eng:WND">London Borough of Wandsworth</option>
    <option value="local-authority-eng:WNM">Royal Borough of Windsor and Maidenhead</option>
    <option value="local-authority-eng:WOC">Worcester City Council</option>
    <option value="local-authority-eng:WOI">Woking Borough Council</option>
    <option value="local-authority-eng:WOK">Wokingham Borough Council</option>
    <option value="local-authority-eng:WOR">Worcestershire County Council</option>
    <option value="local-authority-eng:WOT">Worthing Borough Council</option>
    <option value="local-authority-eng:WOX">West Oxfordshire District Council</option>
    <option value="local-authority-eng:WRL">Wirral Borough Council</option>
    <option value="local-authority-eng:WRT">Warrington Borough Council</option>
    <option value="local-authority-eng:WSK">West Suffolk Council</option>
    <option value="local-authority-eng:WSM">City of Westminster</option>
    <option value="local-authority-eng:WSO">West Somerset District Council</option>
    <option value="local-authority-eng:WSX">West Sussex County Council</option>
    <option value="local-authority-eng:WYC">Wychavon District Council</option>
    <option value="local-authority-eng:WYCA">West Yorkshire Combined Authority</option>
    <option value="local-authority-eng:WYE">Wyre Forest District Council</option>
    <option value="local-authority-eng:WYO">Wycombe District Council</option>
    <option value="local-authority-eng:WYR">Wyre Borough Council</option>
    <option value="local-authority-eng:YOR">City of York Council</option>
    <option value="national-park-authority:Q20198711">South Downs National Park Authority</option>
    <option value="national-park-authority:Q27159704">Lake District National Park Authority</option>
    <option value="national-park-authority:Q27178932">Yorkshire Dales National Park Authority</option>
    <option value="national-park-authority:Q4972284">Broads Authority</option>
    <option value="national-park-authority:Q5225646">Dartmoor National Park Authority</option>
    <option value="national-park-authority:Q72617158">New Forest National Park Authority</option>
    <option value="national-park-authority:Q72617669">North York Moors National Park Authority</option>
    <option value="national-park-authority:Q72617784">Exmoor National Park Authority</option>
    <option value="national-park-authority:Q72617890">Northumberland National Park Authority</option>
    <option value="national-park-authority:Q72617988">Peak District National Park Authority</option>
    <option value="public-authority:Q5533909">GeoPlace</option>
    <option value="regional-park-authority:Q6515400">Lee Valley Regional Park Authority</option>
    <option value="transport-authority:Q25171369">West Midlands Passenger Transport Executive</option>
    <option value="transport-authority:Q6820591">Merseytravel</option>
    <option value="transport-authority:Q682520">Transport for London</option>
    <option value="transport-authority:Q7569004">South Yorkshire Passenger Transport Executive</option>
    <option value="transport-authority:Q7834921">Transport for Greater Manchester</option>
    <option value="transport-authority:Q7860508">Tyne and Wear Passenger Transport Executive</option>
    <option value="transport-authority:Q7985947">Transport for West Midlands</option>
    <option value="transport-authority:Q7987043">West Yorkshire Passenger Transport Executive</option>
    <option value="waste-authority:Q20711950">East London Waste Authority</option>
    <option value="waste-authority:Q20713477">North London Waste Authority</option>
    <option value="waste-authority:Q21921612">West London Waste Authority</option>
    <option value="waste-authority:Q21935501">Western Riverside Waste Authority</option>
    <option value="waste-authority:Q5600652">Greater Manchester Waste Disposal Authority</option>
  </select>
</div>
  <p class="govuk-!-margin-bottom-0 govuk-!-margin-top-1 dl-map__error js-hidden" data-module="organisation-search-error">Boundary for organisation not found.</p>
</div>


    </div>
    
</div>


<div class="govuk-form-group">
  <div class="hover-box govuk-!-width-one-half"></div>
</div>

<script src="/static/javascripts/dl-frontend.js"></script>
<script src="https://digital-land.github.io/javascripts/vendor/govuk-accessible-autocomplete.min.js"></script>
<script>

var testA



(function(dlf, accessibleAutocomplete) {

  let organisationMapper = {}
  const bfsHelpers = DLMaps.brownfieldSites

  const $sidePanel = document.querySelector(".dl-map__side-panel")
  const $mapItems = document.querySelector("[data-module='dl-map-items']")
  const $boundaryCount = $mapItems.querySelector(".organisation-count")
  const $activeOrganisation = $mapItems.querySelector(".active-organisation")
  console.log($mapItems)

  const $picker = document.querySelector('#dl-organisation-autocomplete')
  const $orgSearchError = document.querySelector("[data-module='organisation-search-error']")
  
  function handleOrganisationSearch(val) {
    const orgname = dlf.utils.toCamelCase(val)
    if (Object.prototype.hasOwnProperty.call(laTracker, orgname)) {
      console.log("We have a match")
      $orgSearchError.classList.add("js-hidden")
      const match = laTracker[orgname]
      handleBrownfieldSiteLoad(match.id, match.boundaryLayer)
    } else {
      console.log("We do not have a match for ", orgname)
      $orgSearchError.classList.remove("js-hidden")
    }
  }

  accessibleAutocomplete.enhanceSelectElement({
    selectElement: $picker,
    onConfirm: handleOrganisationSearch
  })



  const $hoverBox = document.querySelector('.hover-box')
  const $mapElement = document.querySelector('[data-module="boundary-map"]')
  exmap = new DLMaps.Map($mapElement).init({})

  //const dlf = DLFrontend

  function laBoundaryURL(st_geo_code) {
    return `https://raw.githubusercontent.com/digital-land/boundary-collection/master/collection/local-authority/${st_geo_code}/index.geojson`
  }

  function addProperty(feature, name, value) {
    if( feature.properties ) {
      feature.properties[name] = value
    }
  }
  
  var bs = [{"id": "local-authority-eng:STO", "statistical_geography": "E07000082", "name": "Stroud District Council", "count": 86}, {"id": "local-authority-eng:LEE", "statistical_geography": "E07000063", "name": "Lewes District Council", "count": 56}, {"id": "local-authority-eng:TAM", "statistical_geography": "E08000008", "name": "Tameside Metropolitan Borough Council", "count": 88}, {"id": "local-authority-eng:EAS", "statistical_geography": "E07000061", "name": "Eastbourne Borough Council", "count": 117}, {"id": "local-authority-eng:CRA", "statistical_geography": "E07000163", "name": "Craven District Council", "count": 43}, {"id": "local-authority-eng:WDO", "statistical_geography": "E07000052", "name": "West Dorset District Council", "count": 47}, {"id": "local-authority-eng:STV", "statistical_geography": "E07000243", "name": "Stevenage Borough Council", "count": 22}, {"id": "national-park-authority:Q4972284", "statistical_geography": "E26000007", "name": "Broads Authority", "count": 28}, {"id": "local-authority-eng:HRW", "statistical_geography": "E09000015", "name": "London Borough of Harrow", "count": 102}, {"id": "local-authority-eng:SSO", "statistical_geography": "E07000189", "name": "South Somerset District Council", "count": 59}, {"id": "local-authority-eng:TEW", "statistical_geography": "E07000083", "name": "Tewkesbury Borough Council", "count": 15}, {"id": "local-authority-eng:WGN", "statistical_geography": "E08000010", "name": "Wigan Metropolitan Borough Council", "count": 157}, {"id": "local-authority-eng:FYL", "statistical_geography": "E07000119", "name": "Fylde Borough Council", "count": 1}, {"id": "local-authority-eng:SEL", "statistical_geography": "E07000169", "name": "Selby District Council", "count": 61}, {"id": "local-authority-eng:BST", "statistical_geography": "E06000023", "name": "Bristol City Council", "count": 392}, {"id": "local-authority-eng:CON", "statistical_geography": "E06000052", "name": "Cornwall Council", "count": 167}, {"id": "local-authority-eng:DOV", "statistical_geography": "E07000108", "name": "Dover District Council", "count": 59}, {"id": "local-authority-eng:BNH", "statistical_geography": "E06000043", "name": "Brighton and Hove City Council", "count": 220}, {"id": "local-authority-eng:WDE", "statistical_geography": "E07000047", "name": "West Devon Borough Council", "count": 4}, {"id": "local-authority-eng:WYC", "statistical_geography": "E07000238", "name": "Wychavon District Council", "count": 22}, {"id": "local-authority-eng:WFT", "statistical_geography": "E09000031", "name": "London Borough of Waltham Forest", "count": 63}, {"id": "local-authority-eng:CHO", "statistical_geography": "E07000118", "name": "Chorley Borough Council", "count": 88}, {"id": "local-authority-eng:MSU", "statistical_geography": "E07000203", "name": "Mid Suffolk District Council", "count": 10}, {"id": "local-authority-eng:STO", "statistical_geography": "E07000082", "name": "Stroud District Council", "count": 86}, {"id": "local-authority-eng:WOC", "statistical_geography": "E07000237", "name": "Worcester City Council", "count": 57}, {"id": "local-authority-eng:AYL", "statistical_geography": "E07000004", "name": "Aylesbury Vale District Council", "count": 24}, {"id": "local-authority-eng:EPS", "statistical_geography": "E07000208", "name": "Epsom and Ewell Borough Council", "count": 16}, {"id": "local-authority-eng:BDF", "statistical_geography": "E06000055", "name": "Bedford Borough Council", "count": 112}, {"id": "development-corporation:Q6670544", "statistical_geography": "E51000001", "name": "London Legacy Development Corporation", "count": 3}, {"id": "local-authority-eng:NWA", "statistical_geography": "E07000218", "name": "North Warwickshire Borough Council", "count": 37}, {"id": "local-authority-eng:DAV", "statistical_geography": "E07000151", "name": "Daventry District Council", "count": 8}, {"id": "local-authority-eng:STE", "statistical_geography": "E06000021", "name": "Stoke-on-Trent City Council", "count": 213}, {"id": "local-authority-eng:IOS", "statistical_geography": "E06000053", "name": "Council of the Isles of Scilly", "count": 3}, {"id": "local-authority-eng:EDO", "statistical_geography": "E07000049", "name": "East Dorset District Council", "count": 29}, {"id": "local-authority-eng:DAL", "statistical_geography": "E06000005", "name": "Darlington Borough Council", "count": 13}, {"id": "local-authority-eng:BOT", "statistical_geography": "E07000136", "name": "Boston Borough Council", "count": 45}, {"id": "local-authority-eng:BRX", "statistical_geography": "E07000095", "name": "Broxbourne Borough Council", "count": 42}, {"id": "local-authority-eng:WNM", "statistical_geography": "E06000040", "name": "Royal Borough of Windsor and Maidenhead", "count": 32}, {"id": "local-authority-eng:COP", "statistical_geography": "E07000029", "name": "Copeland Borough Council", "count": 24}, {"id": "local-authority-eng:SHF", "statistical_geography": "E08000019", "name": "Sheffield City Council", "count": 365}, {"id": "local-authority-eng:SFT", "statistical_geography": "E08000014", "name": "Sefton Metropolitan Borough Council", "count": 56}, {"id": "local-authority-eng:NDE", "statistical_geography": "E07000043", "name": "North Devon District Council", "count": 82}, {"id": "local-authority-eng:HYN", "statistical_geography": "E07000120", "name": "Hyndburn Borough Council", "count": 38}, {"id": "local-authority-eng:CLD", "statistical_geography": "E08000033", "name": "Calderdale Metropolitan Borough Council", "count": 180}, {"id": "local-authority-eng:SUF", "statistical_geography": "E07000205", "name": "Suffolk Coastal District Council", "count": 19}, {"id": "local-authority-eng:TON", "statistical_geography": "E07000115", "name": "Tonbridge and Malling Borough Council", "count": 11}, {"id": "local-authority-eng:SHA", "statistical_geography": "E07000044", "name": "South Hams District Council", "count": 14}, {"id": "local-authority-eng:CAN", "statistical_geography": "E07000192", "name": "Cannock Chase District Council", "count": 91}, {"id": "local-authority-eng:WND", "statistical_geography": "E09000032", "name": "London Borough of Wandsworth", "count": 243}, {"id": "local-authority-eng:WLA", "statistical_geography": "E07000127", "name": "West Lancashire Borough Council", "count": 26}, {"id": "national-park-authority:Q72617988", "statistical_geography": "E26000006", "name": "Peak District National Park Authority", "count": 4}, {"id": "local-authority-eng:BNE", "statistical_geography": "E09000003", "name": "London Borough of Barnet", "count": 148}, {"id": "local-authority-eng:FOE", "statistical_geography": "E07000080", "name": "Forest of Dean District Council", "count": 57}, {"id": "local-authority-eng:TUN", "statistical_geography": "E07000116", "name": "Tunbridge Wells Borough Council", "count": 62}, {"id": "local-authority-eng:DER", "statistical_geography": "E06000015", "name": "Derby City Council", "count": 46}, {"id": "local-authority-eng:SNO", "statistical_geography": "E07000149", "name": "South Norfolk District Council", "count": 47}, {"id": "local-authority-eng:HAL", "statistical_geography": "E06000006", "name": "Halton Borough Council", "count": 34}, {"id": "local-authority-eng:SHN", "statistical_geography": "E08000013", "name": "St Helens Council", "count": 110}, {"id": "local-authority-eng:WAV", "statistical_geography": "E07000206", "name": "Waveney District Council", "count": 34}, {"id": "local-authority-eng:BBD", "statistical_geography": "E06000008", "name": "Blackburn with Darwen Borough Council", "count": 33}, {"id": "local-authority-eng:BAI", "statistical_geography": "E07000066", "name": "Basildon Borough Council", "count": 89}, {"id": "local-authority-eng:EHE", "statistical_geography": "E07000242", "name": "East Hertfordshire District Council", "count": 24}, {"id": "local-authority-eng:BNS", "statistical_geography": "E08000016", "name": "Barnsley Metropolitan Borough Council", "count": 49}, {"id": "local-authority-eng:POR", "statistical_geography": "E06000044", "name": "Portsmouth City Council", "count": 145}, {"id": "local-authority-eng:WLI", "statistical_geography": "E07000142", "name": "West Lindsey District Council", "count": 58}, {"id": "local-authority-eng:EAT", "statistical_geography": "E07000086", "name": "Eastleigh Borough Council", "count": 25}, {"id": "local-authority-eng:BDG", "statistical_geography": "E09000002", "name": "London Borough of Barking and Dagenham", "count": 63}, {"id": "development-corporation:Q20648596", "statistical_geography": "E51000002", "name": "Old Oak and Park Royal Development Corporation", "count": 79}, {"id": "local-authority-eng:SOX", "statistical_geography": "E07000179", "name": "South Oxfordshire District Council", "count": 48}, {"id": "local-authority-eng:ELM", "statistical_geography": "E07000207", "name": "Elmbridge Borough Council", "count": 78}, {"id": "local-authority-eng:BOS", "statistical_geography": "E07000033", "name": "Bolsover District Council", "count": 28}, {"id": "local-authority-eng:SLG", "statistical_geography": "E06000039", "name": "Slough Borough Council", "count": 111}, {"id": "local-authority-eng:TOB", "statistical_geography": "E06000027", "name": "Torbay Council", "count": 89}];

  // function createOrgMapper(orgsObj) {
  //   const mapper = {}
  //   orgsObj.forEach(function(o) {
  //     mapper[o['id']] = o['name']
  //   })
  //   return mapper
  // }
  bfsHelpers.registerOrganisationMapper(bs)
  //organisationMapper = dlf.utils.createOrgMapper(bs)
  

// const organisationHoverStyle = {
//   fillOpacity: 0.2,
//   weight: 2,
//   color: '#FFDD00',
//   fillColor: '#FFEE80'
// }

const organisationHoverStyle = {
  fillOpacity: 0.25,
  weight: 2,
  color: '#0b0c0c',
  fillColor: '#003078'
}

const organisationActiveStyle = {
  fillOpacity: 0.2,
  weight: 2,
  color: '#FFDD00',
  fillColor: '#FFEE80'
}

// const brownfieldSiteStyle = {
//   color: "#745729",
//   fillColor: "#745729",
//   fillOpacity: 0.5
// };

// const historicalBrownfieldSiteStyle = {
//   color: "#d53880 ",
//   fillColor: "#f3f2f1",
//   fillOpacity: 0.5
// }


const _defaultIconCreateFunction = function (cluster) {
  // var childCount = cluster.getChildCount();

  // var c = ' marker-cluster-';
  // if (childCount < 10) {
  //   c += 'small';
  // } else if (childCount < 100) {
  //   c += 'medium';
  // } else {
  //   c += 'large';
  // }

  var count = cluster.feature.properties["bfs_count"]
  var center_pt = turf.centerOfMass(cluster.feature)
  var center_pt = turf.center(cluster.feature)

  var center_pt = cluster.getBounds().getCenter()

  var html_marker = new L.DivIcon({ html: '<div><span>' + count + '</span></div>', className: 'marker-cluster', iconSize: new L.Point(40, 40) });

  return L.marker([center_pt['lat'], center_pt['lng']], {icon: html_marker})
  //return L.marker([center_pt.geometry.coordinates[1], center_pt.geometry.coordinates[0]], {icon: html_marker})
}


  function updateHoverBox(layer, show) {
    const v = layer.feature.properties.organisation_name
    if(show) {
      $hoverBox.textContent = v
    } else {
      if ($hoverBox.textContent === v) {
        $hoverBox.textContent = ""
      }
    }
  }

  function addHoverState (feature, layer) {
    exmap.addLayerHoverState(layer, {
      check: function (layer) {
        return !Object.prototype.hasOwnProperty.call(layer, "parentId") || !layer.parentId.activeBoundary
      },
      cb: updateHoverBox
    })
    // layer.on('mouseover', function() {
    //   if(!Object.prototype.hasOwnProperty.call(layer, "parentId") || !layer.parentId.activeBoundary) {
    //     layer.setStyle(organisationHoverStyle)
    //     updateHoverBox(feature.properties.organisation_name)
    //   }
    // })
    // layer.on('mouseout', function() {
    //   if(!Object.prototype.hasOwnProperty.call(layer, "parentId") || !layer.parentId.activeBoundary) {
    //     layer.setStyle(exmap.styles.defaultBoundaryStyle)
    //     updateHoverBox(feature.properties.organisation_name, false)
    //   }
    // })
  }

  L.Path.prototype.setOnParentLayer = function(prop, val) {
    const layer = this
    if(Object.prototype.hasOwnProperty.call(layer, "parentId")) {
      layer.parentId[prop] = val
    }
  }

  function brownfield_data_url(organisation){
    orgDir = dlf.utils.curie_to_url_part(organisation)
    return `https://raw.githubusercontent.com/digital-land/dataset/master/docs/brownfield-land/organisation/${orgDir}/sites.geojson`
  }


  function updateActiveOrgPanel(name) {
    console.log("active, active", name)
    $activeOrganisation.textContent = name
    const $container = $activeOrganisation.parentElement
    if ($container.classList.contains("js-hidden")) {
      $container.classList.remove("js-hidden")
    }
  }


  function setActiveLayer(layer) {
    // track which layer is active
    localAuthorityBoundaries.activeLayer = layer._leaflet_id
    localAuthorityBoundaries.eachLayer(function (layer) {
      layer.activeBoundary = false
      layer.setStyle(exmap.styles.defaultBoundaryStyle)
    })
    layer.setOnParentLayer("activeBoundary", true)
    layer.parentId.setStyle(organisationActiveStyle)

    // should this be done another way? i.e. trigger an event on the side panel?
    updateActiveOrgPanel(layer.feature.properties['organisation_name'])
  }

  function handleBrownfieldSiteLoad(organisation_id, layer) {
    const url = brownfield_data_url(organisation_id)
    exmap.zoomToLayer(layer)
    loadBrownfieldSites(url, organisation_id)
    setActiveLayer(layer)
  }

  function addLayerClickEvent(feature, layer) {
    layer.on('click', function(e) {
      handleBrownfieldSiteLoad(feature.properties.organisation, layer)
    })
  }

  function authorityLayerControls(feature, layer) {
    const props = feature.properties
    // function is run for each boundary that is plotted
    //layer.activeBoundary = false
    console.log("creating:", layer)
    layer.on("add", function(e) {
      console.log("My parent is", )
      console.log(e)
    })
    addHoverState(feature, layer)
    addLayerClickEvent(feature, layer)

    // var count = feature.properties['bfs_count'] || 100
    // var cluster_count = _defaultIconCreateFunction(layer)
    // console.log("cluster marker", cluster_count)
    // cluster_count.addTo(clusterGroup)

    // var toolTip_str = `${props["organisation_name"]}, ${props['bfs_count']} brownfield sites`
    // var tooltip = L.tooltip({direction:'center', className: "dl-map__org-label"})
    // tooltip.setContent(toolTip_str)
    // console.log("tooltip", tooltip)
    // layer.bindTooltip(tooltip);
  }


  // function siteSize(hectares) {
  //   if (isNaN(hectares)) {
  //       return 100;
  //   } else {
  //       return (Math.sqrt((hectares * 10000) / Math.PI))
  //   }
  // }

  // var bfsTooltipTemplate =
  //   '<div class="bfs">' +
  //   '{hasEndDate}' +
  //   '<div class="bfs__header">' +
  //   '<span class="govuk-caption-s">{site}</span>' +
  //   '<h3 class="govuk-heading-s bfs__addr">{site-address}</h3>' +
  //   '<span class="bfs__coords">{latitude},{longitude}</span>' +
  //   '</div>' +
  //   '<div class="govuk-grid-row bfs__key-data">' +
  //   '<dl class="govuk-grid-column-one-half">' +
  //   '<dt>Hectare</dt>' +
  //   '<dd>{hectares}</dd>' +
  //   '</dl>' +
  //   '<dl class="govuk-grid-column-one-half">' +
  //   '<dt>Dwellings</dt>' +
  //   '<dd>{isRange}</dd>' +
  //   '</dl>' +
  //   '</div>' +
  //   '<div class="bfs__meta">' +
  //   '{orgLink}' +
  //   '{extraData}' +
  //   '{datesSection}' +
  //   '</div>' +
  //   '<div class="bfs__footer">' +
  //   'From resource: <a href="https://digital-land.github.io/resource/{resource}" class="govuk-link">{resourceTrunc}</a>' +
  //   '</div>' +
  //   '</div>';

  // function hasEndDate(data) {
  //     if(data['end-date']) {
  //         return '<span class="bfs__end-banner">End date: ' + data['end-date'] + '</span>';
  //     }
  //     return "";
  // }

  // function isRange(data) {
  //     var str = data['minimum-net-dwellings'];
  //     if(data['minimum-net-dwellings'] != null) {
  //         if(parseInt(data['minimum-net-dwellings']) !== parseInt(data['maximum-net-dwellings']) || parseInt(data['maximum-net-dwellings']) === 0 ) {
  //             str = data['minimum-net-dwellings'] + "-" + data['maximum-net-dwellings'];
  //         }
  //         return str;
  //     }
  //     return ""
  // }

  // function datesSection(data) {
  //     return '<dl>' +
  //     '<dt>Date added</dt>' +
  //     `<dd>${data['start-date']}</dd>` +
  //     '</dl>';
  // }

  // function linkToOrg(data) {
  //   var orgName = data['organisation']
  //   if(Object.prototype.hasOwnProperty.call(organisationMapper, data['organisation'])) {
  //     orgName = organisationMapper[data['organisation']]
  //   }
  //   return '<dl>' +
  //   '<dt>Organisation</dt>' +
  //   `<dd><a class="govuk-link" href="https://digital-land.github.io/organisation/${dlf.utils.curie_to_url_part(data['organisation'])}">${orgName}</a></dd>` +
  //   '</dl>';
  // }

  // function hasURL(urlField) {
  //   if(urlField) {
  //     return [
  //       '<div class="bfs__footer">',
  //         `<a href="${urlField}" class="govuk-link">See on authority website</a>.`,
  //       '</div>'
  //     ].join("\n")
  //   }
  //   return ""
  // }

  // function createBFSPopup(row) {
  //   // need to find a way to clone object that will work in more browsers
  //   processedData = {...row}
  //   processedData.isRange = isRange
  //   processedData.hasEndDate = hasEndDate
  //   processedData.datesSection = datesSection
  //   processedData.orgLink = linkToOrg
  //   processedData.resourceTrunc = dlf.utils.truncate(row['resource'], 9)
  //   processedData.siteURL = hasURL(row['site-plan-url'])
  //   var extraData = ""
  //   var potentiallyNullFields = ["deliverable", "hazardous-substances", "ownership", "planning-permission-status", "planning-permission-type"]
  //   potentiallyNullFields.forEach(function(field) {
  //     if(!!row[field]) {
  //       extraData += [
  //       '<dl>',
  //         `<dt>${field}</dt>`,
  //         `<dd>${row[field]}</dd>`,
  //       '</dl>' 
  //       ].join("\n")
  //     }
  //   })
  //   processedData.extraData = extraData
  //   return L.Util.template(bfsHelpers.popupTemplate, processedData); 
  // }

  // function bfsControls(feature, layer) {
  //   var popupHTML = bfsHelpers.createPopup(feature.properties)
  //   layer
  //     .bindPopup(popupHTML, bfsHelpers.popupOptions)
  //     .on("popupopen", function(e) {
  //       console.log("Brownfield site selected", e.sourceTarget.feature)
  //     })
  // }

  // function plotBFS(feature, latlng) {
  //   var style = (feature.properties['end-date']) ? historicalBrownfieldSiteStyle : brownfieldSiteStyle
  //   console.log("historic", Boolean(feature.properties['end-date']))
  //   var size = bfsHelpers.calcSiteSize(feature.properties['hectares'])
  //   style.radius = size.toFixed(2)
  //   //layer.setStyle(style)
  //   return L.circle(latlng, style);
  // }


  var localAuthorityBoundaries = exmap.createFeatureGroup("localAuthorityBoundaries").addTo(exmap.map)
  var brownfieldSiteGroups = exmap.createFeatureGroup('brownfieldSiteGroups').addTo(exmap.map)
  var clusterGroup = exmap.createFeatureGroup('clusterGroup').addTo(exmap.map)


  function loadBrownfieldSites(url, organisation) {
    bfsHelpers.loadSites(exmap, url, organisation, { layerGroup: brownfieldSiteGroups})
    //organisationCC = dlf.utils.toCamelCase(organisation)
    // if (exmap.featureGroups.hasOwnProperty(organisationCC)) {
    //   // no need to fetch if we've done that before
    //   console.log("collected before")
    // } else {
    //   console.log("fetch from url", url)
    //   fetch(url)
    //   .then(resp => resp.json())
    //   .then((data) => {
    //     var l = exmap.createFeatureGroup(organisationCC)
    //     L.geoJSON(data, {
    //       pointToLayer: plotBFS,
    //       onEachFeature: bfsControls
    //     })
    //     .addTo(l)
    //     l.addTo(brownfieldSiteGroups)
    //     console.log(data)
    //   })
    //   .catch(function(err) {
    //     console.log('error', err)
    //   })
    // }
  }

  function initLaTrackerItem(name, id) {
    const trackerId = dlf.utils.toCamelCase(name)
    laTracker[dlf.utils.toCamelCase(name)] = {
      "name": name,
      "id": id,
      "loadedBFS": false
    }
    return trackerId
  }

  var laTracker = {}
  var failing = []
  Promise.allSettled(
    bs.map(function(b) {
      const url = laBoundaryURL(b.statistical_geography)
      // track the LA we have on the map
      const trackerId = initLaTrackerItem(b.name, b.id)
      return fetch(url)
        .then(resp => resp.json())
        .then((data) => {
          addProperty(data.features[0], "organisation", b.id)
          addProperty(data.features[0], "organisation_name", b.name)
          addProperty(data.features[0], "bfs_count", b.count)
          //addProperty(data.features[0], "name", b.name)
          console.log(data)
          var boundary = L.geoJSON(data, {
            style: exmap.styles.defaultBoundaryStyle,
            onEachFeature: authorityLayerControls
          })
          .on("add", function(e) {
            const parentLayer = e.target
            parentLayer.activeBoundary = false
            laTracker[trackerId]["layer"] = parentLayer
            console.log("Parent layer", parentLayer._leaflet_id)
            for (var prop in parentLayer._layers) {
              if (Object.prototype.hasOwnProperty.call(parentLayer._layers, prop)) {
                const childLayer = parentLayer._layers[prop]
                console.log(childLayer)
                childLayer.parentId = localAuthorityBoundaries.getLayer(parentLayer._leaflet_id)
                laTracker[trackerId]["boundaryLayer"] = childLayer
              }
            }
          })
          .addTo(localAuthorityBoundaries)
          return boundary
        })
        .catch(function(err) {
          console.log(b.id, 'error', err)
          failing.push([b.id, b.statistical_geography])
        })
    }
  )).then(boundaries => {
    // after all boundaries collected then fitBounds of map
    exmap.map.fitBounds(localAuthorityBoundaries.getBounds())
    exmap.hideLoader()
    console.log(bs)
    $boundaryCount.textContent = bs.length - failing.length
    $mapItems.classList.remove("js-hidden")
    $sidePanel.classList.remove("js-hidden")
  })

  window.laTracker = laTracker

  exmap.map.on("zoom", function(e) {
    const zoomLevel = exmap.map.getZoom()
    if (zoomLevel > 7) {
      brownfieldSiteGroups.addTo(exmap.map)
    } else {
      brownfieldSiteGroups.remove()
    }
  })

})(window.DLFrontend, window.accessibleAutocomplete)
</script>
    <script src="https://digital-land.github.io/javascripts/govuk/govuk-frontend.min.js"></script>
    <script>
        // initiate all GOVUK components
        window.GOVUKFrontend.initAll();
    </script>
    
    <script src="https://digital-land.github.io/javascripts/dl-frontend.js"></script>

    <script src="https://digital-land.github.io/javascripts/vendor/govuk-accessible-autocomplete.min.js"></script>

    <!-- should move this to dl-frontend.js -->
    <script>
        const $inputCopyElements = document.querySelectorAll('[data-module*="input-copy"]')
        $inputCopyElements.forEach(function ($input) {
            new window.DLFrontend.InputCopy($input).init()
        })
    </script>

    <script>
        const $picker = document.querySelector('#organisation-search')
        if ($picker) {
            accessibleAutocomplete.enhanceSelectElement({
                selectElement: $picker
            })
        }
    </script>
    
</body>
</html>